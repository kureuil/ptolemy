name: Elixir CI

on: push

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-node@v1
      with:
        node-version: "12.x"
    - uses: actions/setup-elixir@v1
      with:
        otp-version: "22.0.7"
        elixir-version: "1.9.1"
    - run: |
        mix deps.get
        mix deps.compile
        npm install --prefix assets
        npm run --prefix assets deploy
        mix phx.digest
        mix compile
        mix release --path tequila-master
        tar czf tequila-master.tar.gz tequila-master
    - uses: actions/upload-artifact@master
      with:
        name: tequila-master.tar.gz
        path: ./tequila-master.tar.gz
